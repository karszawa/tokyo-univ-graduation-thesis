\chapter{提案手法}

本研究ではアスリートと管理栄養士が行うコミュニケーションを食事画像の解析技術を用いたシステムで簡便化する。
このシステムは食事画像の解析をサーバーで行い、ユーザーはそれぞれのクライアントアプリケーションを使用する。
更にアスリートの食事記録や体組成値、管理栄養士のフィードバック情報はすべてシステムに保管されるため、それがデータセットとして利用可能になる。
以上の構成を図\ref{fig:proposed-system}にまとめた。

![提案システムにおける情報の流れ](fig/proposed-system.eps){width=\linewidth}

アスリートはこのアプリケーションを食事の直前に使うため、
いつでも使用可能なモバイルアプリケーションというかたちがふさわしい。
管理栄養士はこのシステムを他の様々なWebアプリケーションと同時に使用するため、
このシステムもWebアプリケーションとして実装するのが良いと思われる。
実際のデータの流れを図\ref{fig:architecture}に示した。
次節以降でそれぞれのアプリケーションについて詳細に説明する。

![システム構成](fig/architecture.eps){width=\linewidth}

# アスリート側

アスリート側のアプリケーションについて説明する。

このアプリケーションに最低限必要な機能は以下のものである。

- 食事の写真をアプリケーション内に記録できる
- 食事の写真を管理栄養士と共有できる
- その日に摂取したエネルギーを計算・表示できる
- 管理栄養士からのコメントを表示することができる
- 管理栄養士にコメントすることができる

これらの機能を大雑把に分けると食事記録の作成・食事記録の閲覧・管理栄養士とのメッセージという3つの機能に分類することができる。
以下で各機能について画面のスクリーンショットと共に紹介する。

## 食事記録の作成

図\ref{fig:create-record-1}と図\ref{fig:create-record-2}は食事記録の作成の手順をまとめたものである。

![食事記録の作成時の画面遷移（大まかな流れ）](fig/create-record-1.eps){width=0.6\linewidth}
![食事記録の作成時の画面遷移（料理の訂正）](fig/create-record-2.eps){width=\linewidth}

図\ref{fig:create-record-1}は食事作成時の大まかな画面遷移を表したものである。
食事作成の手順は食事の画像を撮影するところから始まる。
写真を撮影するとFoodLogの食事認識APIによって写真に写っている料理ごと料理品目とセグメントが同定される。
認識が間違っているときはアスリートが自身で修正することもできる。
品目が正しければ確認画面に遷移し、時刻とコメントを入力し食事記録を作成する。
なお、料理写真はすでに撮影済みのものを用いてもいいし、用いなくても良い。
写真を用いない場合は従来の手法通り、テキストによる料理名の検索によって食事記録を作成する。

図\ref{fig:create-record-2}に食事認識結果の訂正方法を示した。
まず、料理が認識されていない場合は画像の対象部分を長押しすることで料理を追加できる。
認識結果や分量が間違っている場合は料理のカラムをタップし料理の編集画面に遷移する。
編集画面では料理品目や分量を変更することができ、品目ごとの栄養素を確認できる。
料理品目はテキストにより検索できる。
検索画面では一般食品1453品目と食事製品約9万品目の料理を検索することができる。
また、食事製品については製品についているバーコードの画像認識によって検索することもできる。
アスリートはプロテインなどの市販品を摂取する頻度が非常に高いため、この機能が必要であった。
また、検索画面では過去に選択した料理が候補として表示されるので、頻繁に摂る食事は簡易に入力できる。

このようにして、本システムではFoodLogの食事画像認識APIによって食事記録の際の料理品目の選択という工程を簡単に行うことができる。

## 食事記録の閲覧

図\ref{fig:index-report}の画面では食事記録の一覧を確認することができる。
食事記録は日毎に整理され、エネルギーと3大栄養素（たんぱく質・炭水化物・脂質）を確認できる。
アスリートは管理栄養士からエネルギー・栄養素の目標値を伝えられているので、
その値に達するにはあとどれだけ食事を摂れば良いのかということがわかる。
食事記録の画像をタップすることで記録の詳細を確認できる。
ここではエネルギーと3大栄養素に加えて以下の栄養素を確認することができる。

- 食物繊維量
- カルシウム
- 鉄
- レチノール活性当量
- ビタミンB1
- ビタミンB2
- ビタミンC

\begin{figure}[htbp]
  \centering
  \subfigure[食事記録の一覧画面]{
    \fbox{\includegraphics*[width=0.3\linewidth]{fig/index-record-1.eps}}
    \label{fig:index-record-1}
  }
  \subfigure[食事記録の詳細画面]{
    \fbox{\includegraphics*[width=0.3\linewidth]{fig/index-record-2.eps}}
    \label{fig:index-record-2}
  }
  \caption{食事記録の閲覧画面}
  \label{fig:index-record}
\end{figure}

## 管理栄養士とのメッセージ

図\ref{fig:message}は管理栄養士とのメッセージ画面である。
この画面には管理栄養士からのアドバイスが表示される。
また、メッセージは双方向のものなので、アスリートから管理栄養士に質問などを送ることもできる。

\begin{figure}[htbp]
  \centering
  \subfigure[管理栄養士からのアドバイス]{
    \fbox{\includegraphics*[width=0.3\linewidth]{fig/message-1.eps}}
    \label{fig:message-1}
  }
  \subfigure[アスリートから質問を行い管理栄養士がそれに答える様子]{
    \fbox{\includegraphics*[width=0.3\linewidth]{fig/message-2.eps}}
    \label{fig:message-2}
  }
  \caption{管理栄養士とのメッセージ画面}
  \label{fig:message}
\end{figure}

# 管理栄養士側

管理栄養士の業務について今一度説明する。
管理栄養士は担当している数人から十数人のアスリートすべてに対して、
そのアスリートが過去3日から1週間程度で何を食事をしたかを記録・参照し、
アスリートの目標・体組成値・体調・練習量等を考慮し次に何を食べるべきかを提案する。
この際、体組成値（体重や腹囲・除脂肪量等）と練習量は本研究で提案するものとは別のアプリケーションを用いて記録する[^body-composition]。
また、目標や体調はその時々でヒアリングを行う。

[^body-composition]: 開発したシステムを実際に使ってもらうアスリートのグループがすでに Google Form を用いて体組成値を記録していたので、本システムでは記録の対象としなかった。より一般的なシステムとする場合は体組成値も記録する仕組みが必要になる。

このように、管理栄養士の診断には様々な行為が伴い複雑である。
そこで、本研究では管理栄養士のためのアプリケーションはWebサービスとして提供することにした。

管理栄養士のアプリケーションに必要になるのは以下の機能である。

- 数人〜十数人のアスリートの情報（氏名・年齢・目的等）を参照できる
- アスリートの食事画像を見ながらコメントを入力できる
- コメントと食事をまとめてレポートを作成できる
- 選手からの食事画像・メッセージが来たときに通知を受け取ることができる

以上の点を踏まえた画面を図\ref{fig:dietitian-app-1}に示す。

![管理栄養士側のWebアプリケーションの画面](./fig/dietitian-app-1.eps){width=\linewidth}

この画面では複数のアスリートの身体情報・目標・食事記録とメッセージ画面を表示できる。
1の箇所には選手一覧が表示されているので、確認したい選手を探したり新着メッセージの数を確認したりできる。
2の箇所には選手の氏名・所属・体組成値が表示される。
3の箇所では栄養素ごとの目標値が表示される。
図\ref{fig:dietitian-app-2}が目標値を設定する画面である。
こうして管理栄養士にアスリートごとの栄養素目標値を入力してもらうことで、
アスリートは自身の食事の自己採点が可能になる。

![管理栄養士側のWebアプリケーションの画面（目標値の設定）](./fig/dietitian-app-2.eps){width=\linewidth}

4の箇所ではアスリートとメッセージのやり取りを行うことができる。
食事記録へのアドバイスもここに表示される。
5の箇所にはアスリートの食事記録が表示される。
管理栄養士はこの画面で過去の食事一覧を参照しつつアスリートへのアドバイスを作成することができる。
各料理に対しすでにカロリーなどの栄養素が設定されているので管理栄養士が栄養素を入力する手間が軽減される。
図\ref{fig:dietitian-app-3}がアドバイスの作成画面である。
この画面では食事ごとのや日毎の栄養素の合計値を確認でき、
3大栄養素についてはそれぞれの栄養素の重量比も確認できる。

![管理栄養士側のWebアプリケーションの画面（アドバイス作成）](./fig/dietitian-app-3.eps){width=\linewidth}
